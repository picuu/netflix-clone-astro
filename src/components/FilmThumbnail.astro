---
import { Image } from 'astro:assets'

import { PlayIcon, PlusIcon, ThumbsUpTwoIcon, ThumbsUpIcon, ThumbsDownIcon, ChevronDownIcon } from '@/assets/icons'

import { ButtonCircle, HoverMenu, HoverMenuOptions, MaturingRatingIcon } from '@/components'
import type { ImageMetadata } from 'astro'

interface Props {
  name: string
  thumbnail: ImageMetadata
  logo: ImageMetadata
  scene: string
  slug: string
  maturingRating: 0 | 7 | 12 | 16 | 18
  duration: string
  genres: string[]
}

const { name, thumbnail, logo, scene, slug, maturingRating, duration, genres }: Props = Astro.props
---

<script src="@/scripts/handleScenePreviewVideos.js"></script>

<article class="thumbnail">
  <div class="media-wrapper">
    <Image class="film-thumbnail" id={`${slug}-thumbnail`} src={thumbnail} alt={name} />

    <div class="video-container">
      <img class="film-logo" src={logo.src} alt={name} />

      <video class="scene-preview" data-film-name={slug} muted>
        <source src={scene} type="video/mp4" />
      </video>
    </div>
  </div>

  <div class="card-content">
    <menu class="card-actions">
      <ButtonCircle><PlayIcon /></ButtonCircle>
      <ButtonCircle style="secondary"><PlusIcon /></ButtonCircle>

      <HoverMenu>
        <ButtonCircle style="secondary" slot="trigger"><ThumbsUpIcon /></ButtonCircle>

        <HoverMenuOptions>
          <ButtonCircle size="small" style="tertiary"><ThumbsDownIcon /></ButtonCircle>
          <ButtonCircle size="small" style="tertiary"><ThumbsUpIcon /></ButtonCircle>
          <ButtonCircle size="small" style="tertiary"><ThumbsUpTwoIcon /></ButtonCircle>
        </HoverMenuOptions>
      </HoverMenu>

      <ButtonCircle style="secondary"><ChevronDownIcon /></ButtonCircle>
    </menu>

    <ul class="list card-meta-info">
      <li class="maturing-rating"><MaturingRatingIcon age={maturingRating} /></li>
      <li class="duration">{duration}</li>
      <li class="quality-badge">HD</li>
    </ul>

    <ul class="list card-genre-list">
      {genres.map((genre) => <li class="card-genre-item">{genre}</li>)}
    </ul>
  </div>
</article>

<style>
  .thumbnail {
    --scaling-duration: 185ms;
    --scaling-delay: 350ms;

    position: relative;
    z-index: 1;
    transition:
      transform var(--scaling-duration) ease-in-out,
      z-index 0ms 300ms;

    &:nth-child(6n + 2) {
      transform-origin: 0 100%;
    }

    &:nth-child(6n + 1) {
      transform-origin: 100% 100%;
    }

    & .media-wrapper {
      position: relative;
      width: 100%;
      height: auto;
      aspect-ratio: 16 / 9;
      border-radius: 4px;
      overflow: hidden;
      cursor: pointer;
      transition: border-radius var(--scaling-duration) ease-in-out;
    }

    & .media-wrapper .film-thumbnail {
      opacity: 1;
      transition:
        display 300ms ease-in-out allow-discrete,
        opacity 300ms ease-in-out;

      &.visible {
        display: block !important;
        opacity: 1 !important;
        transition-delay: 0ms !important;
      }
    }

    & .media-wrapper .film-thumbnail,
    & .media-wrapper .video-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    & .media-wrapper img,
    & .media-wrapper video {
      height: 100%;
      object-fit: contain;
    }

    & .media-wrapper .video-container {
      display: none;
      opacity: 0;
      transition:
        display var(--scaling-duration) ease-in-out allow-discrete,
        opacity var(--scaling-duration) ease-in-out;

      & .film-logo {
        position: absolute;
        left: 1%;
        bottom: 1.5%;
        width: 42%;
        height: auto;
        transition: opacity var(--scaling-duration) ease-in-out;
      }

      &.hidden {
        opacity: 0 !important;
        transition-duration: 350ms !important;
        transition-delay: 100ms !important;
      }
    }

    /* SCALE THE THUMBNAIL CARD */
    &:hover {
      transform: scale(1.5) translateY(-3.5rem);
      z-index: 99;
      transition-delay: var(--scaling-delay);

      &:nth-child(6n + 2),
      &:nth-child(6n + 1) {
        transform: scale(1.5) translateY(-1.5rem);
      }
    }

    &:hover .media-wrapper {
      border-top-left-radius: 0.65rem;
      border-top-right-radius: 0.65rem;
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
      transition-delay: var(--scaling-delay);
    }

    /* SHOW SCENE PREVIEW */
    &:hover .media-wrapper .video-container {
      display: block;
      opacity: 1;
      transition-delay: 850ms;

      @starting-style {
        opacity: 0;
      }
    }

    /* HIDE THUMNBAIL IMAGE */
    &:hover .media-wrapper .film-thumbnail {
      display: none;
      opacity: 0;
      transition-delay: 1s;

      @starting-style {
        display: block;
        opacity: 1;
      }
    }

    /* SHOW PREVIEW CARD CONTENT */
    &:hover .card-content {
      display: flex;
      opacity: 1;
      transition-delay: 250ms;

      @starting-style {
        opacity: 0;
      }
    }
  }

  .card-content {
    --gap: 0.5rem;
    --gap-sm: calc(var(--gap) - 0.3rem);
    --gap-lg: calc(var(--gap) + 0.3rem);

    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    display: none;
    flex-direction: column;
    gap: var(--gap-lg);
    padding: 1.5em 1.2em 1.7em;
    margin-top: -1px;
    background-color: #181818;
    border-bottom-left-radius: 0.65rem;
    border-bottom-right-radius: 0.65rem;
    font-size: 10px;
    opacity: 0;
    transition:
      display var(--scaling-duration) ease-in-out allow-discrete,
      opacity var(--scaling-duration) ease-in-out;

    & .list {
      display: flex;
      align-items: center;
      gap: var(--gap);
      list-style: none;

      & li {
        display: flex;
        align-items: center;
        gap: var(--gap);
        color: #fff;
      }
    }

    .card-actions {
      display: flex;
      align-items: center;
      gap: var(--gap);

      & button {
        font-size: 18px;
      }

      & button > svg {
        --size: 100%;
        width: var(--size);
        height: var(--size);
        cursor: pointer;
      }

      & button:last-of-type {
        margin-left: auto;
      }
    }

    & .card-meta-info {
      & .maturing-rating svg {
        --size: 2.6em;
        width: var(--size);
        height: var(--size);
      }

      & .duration {
        color: rgba(255 255 255 / 0.7) !important;
      }

      & .quality-badge {
        padding: 0 0.5em;
        border: 1px solid rgba(255 255 255 / 0.3);
        border-radius: 4px;
        font-size: 0.75em;
        list-style: 1.2;
      }
    }

    & .card-genre-item {
      font-size: 1.05em;

      &:not(:first-of-type)::before {
        --size: 0.5em;

        content: '';
        width: var(--size);
        height: var(--size);
        margin-top: 2px;
        background-color: rgba(255 255 255 / 0.4);
        border-radius: 50%;
      }
    }
  }
</style>
